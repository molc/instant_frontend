# å³æ—¶é€šè®¯ç³»ç»Ÿ API æ–‡æ¡£

> åŸºäºå®é™…ä»£ç ç”Ÿæˆçš„å®Œæ•´APIæ–‡æ¡£ - ç‰ˆæœ¬ 1.0.1

## ğŸ“‹ ç›®å½•

### ğŸ”§ åŸºç¡€ä¿¡æ¯
- [ç‰ˆæœ¬æ›´æ–°è¯´æ˜](#ğŸ†•-ç‰ˆæœ¬æ›´æ–°-v101)
- [åŸºç¡€ä¿¡æ¯](#åŸºç¡€ä¿¡æ¯)
- [è®¤è¯è¯´æ˜](#è®¤è¯è¯´æ˜)

### ğŸ” è®¤è¯ä¸ç”¨æˆ·ç®¡ç†
- [1. è®¤è¯æ¨¡å— (auth)](#1-è®¤è¯æ¨¡å—-auth)
  - 1.1 ç”¨æˆ·ç™»å½•
- [2. ç”¨æˆ·æ¨¡å— (users)](#2-ç”¨æˆ·æ¨¡å—-users)
  - 2.1 åˆ›å»ºç”¨æˆ·
  - 2.2 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  - 2.3 æœç´¢ç”¨æˆ·
  - 2.4 è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€

### ğŸ’¬ æ ¸å¿ƒé€šä¿¡åŠŸèƒ½
- [3. ä¼šè¯æ¨¡å— (conversations)](#3-ä¼šè¯æ¨¡å—-conversations)
  - 3.1 åˆ›å»ºå•èŠ
  - 3.2 åˆ›å»ºç¾¤èŠ
  - 3.3 è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨
  - 3.4 è·å–ä¼šè¯è¯¦æƒ…
  - 3.5 æ›´æ–°ä¼šè¯ä¿¡æ¯
  - 3.6 åˆ é™¤ä¼šè¯
  - 3.7 è·å–ä¼šè¯æˆå‘˜
  - 3.8 æ·»åŠ ä¼šè¯æˆå‘˜
  - 3.9 ç§»é™¤ä¼šè¯æˆå‘˜
  - 3.10 æ›´æ–°ä¼šè¯æˆå‘˜ä¿¡æ¯

- [4. æ¶ˆæ¯æ¨¡å— (messages)](#4-æ¶ˆæ¯æ¨¡å—-messages)
  - 4.1 å‘é€æ–‡æœ¬æ¶ˆæ¯
  - 4.2 å‘é€æ–‡ä»¶æ¶ˆæ¯
  - 4.3 å‘é€ä½ç½®æ¶ˆæ¯
  - 4.4 æœç´¢æ¶ˆæ¯
  - 4.5 è·å–æœªè¯»æ¶ˆæ¯æ•°
  - 4.6 è·å–ä¼šè¯æ¶ˆæ¯
  - 4.7 è·å–å•æ¡æ¶ˆæ¯
  - 4.8 æ›´æ–°æ¶ˆæ¯
  - 4.9 æ’¤å›æ¶ˆæ¯
  - 4.10 æ ‡è®°æ¶ˆæ¯å·²è¯»
  - 4.11 è·å–æ¶ˆæ¯å·²è¯»å›æ‰§
  - 4.12 å‘é€æ­£åœ¨è¾“å…¥æŒ‡ç¤º

- [5. æ–‡ä»¶æ¨¡å— (files)](#5-æ–‡ä»¶æ¨¡å—-files)
  - 5.1 ä¸Šä¼ æ–‡ä»¶
  - 5.2 ä¸‹è½½æ–‡ä»¶
  - 5.3 è·å–æ–‡ä»¶ä¿¡æ¯
  - 5.4 è·å–ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨
  - 5.5 åˆ é™¤æ–‡ä»¶
  - 5.6 è·å–æ–‡ä»¶ä¸‹è½½ä¿¡æ¯

### âš¡ å®æ—¶é€šä¿¡ä¸æ¨é€
- [6. å®æ—¶é€šä¿¡æ¨¡å— (realtime)](#6-å®æ—¶é€šä¿¡æ¨¡å—-realtime)
  - 6.1 è·å–åœ¨çº¿ç”¨æˆ·
  - 6.2 æ£€æŸ¥ç”¨æˆ·åœ¨çº¿çŠ¶æ€
  - 6.3 å‘é€å¹¿æ’­æ¶ˆæ¯
  - 6.4 è·å–è¿æ¥ç»Ÿè®¡

### ğŸ‘¥ é«˜çº§ç¾¤ç»„åŠŸèƒ½
- [7. ç¾¤ç»„é«˜çº§åŠŸèƒ½ (groups)](#7-ç¾¤ç»„é«˜çº§åŠŸèƒ½-groups)
  - 7.1 æ·»åŠ ç¾¤ç»„æˆå‘˜
  - 7.2 ç§»é™¤ç¾¤ç»„æˆå‘˜
  - 7.3 ç”Ÿæˆç¾¤ç»„é‚€è¯·ç 
  - 7.4 è·å–ç¾¤ç»„ç»Ÿè®¡ä¿¡æ¯
  - 7.5 æœç´¢å…¬å¼€ç¾¤ç»„

### ğŸŒ WebSocket å®æ—¶è¿æ¥
- [8. WebSocket å®æ—¶è¿æ¥](#8-websocket-å®æ—¶è¿æ¥)
  - WebSocketè¿æ¥åœ°å€
  - è®¤è¯æ–¹å¼
  - æ¶ˆæ¯æ ¼å¼
  - äº‹ä»¶ç±»å‹è¯¦è§£

### ğŸ”” é€šçŸ¥ç³»ç»Ÿ
- [9. é€šçŸ¥æ¨¡å— (notifications)](#9-é€šçŸ¥æ¨¡å—-notifications)
  - 9.1 è·å–é€šçŸ¥åˆ—è¡¨
  - 9.2 åˆ›å»ºé€šçŸ¥
  - 9.3 è·å–é€šçŸ¥ç»Ÿè®¡
  - 9.4 è·å–å•ä¸ªé€šçŸ¥
  - 9.5 æ›´æ–°é€šçŸ¥
  - 9.6 åˆ é™¤é€šçŸ¥
  - 9.7 æ‰¹é‡å‘é€é€šçŸ¥
  - 9.8 æ ‡è®°é€šçŸ¥å·²è¯»
  - 9.9 æ‰¹é‡æ“ä½œé€šçŸ¥
  - 9.10 è·å–é€šçŸ¥åå¥½è®¾ç½®
  - 9.11 æ›´æ–°é€šçŸ¥åå¥½è®¾ç½®
  - 9.12 è·å–é€šçŸ¥æ¨¡æ¿åˆ—è¡¨
  - 9.13 åˆ›å»ºé€šçŸ¥æ¨¡æ¿
  - 9.14 è·å–é€šçŸ¥æ¨¡æ¿è¯¦æƒ…
  - 9.15 æ›´æ–°é€šçŸ¥æ¨¡æ¿
  - 9.16 åˆ é™¤é€šçŸ¥æ¨¡æ¿

### ğŸ›¡ï¸ å®‰å…¨ä¸ç³»ç»Ÿ
- [10. å®‰å…¨æµ‹è¯•æ¨¡å— (security)](#10-å®‰å…¨æµ‹è¯•æ¨¡å—-security)
  - 10.1 é€Ÿç‡é™åˆ¶æµ‹è¯•
  - 10.2 å®‰å…¨å¤´æµ‹è¯•
  - 10.3 å…³é”®ç«¯ç‚¹æµ‹è¯•
  - 10.4 CORSæµ‹è¯•
  - 10.5 è·å–å®‰å…¨çŠ¶æ€
  - 10.6 æ¨¡æ‹Ÿæ”»å‡»æµ‹è¯•

- [11. ç³»ç»Ÿæ¨¡å— (system)](#11-ç³»ç»Ÿæ¨¡å—-system)
  - 11.1 å¥åº·æ£€æŸ¥
  - 11.2 æ ¹è·¯å¾„

### ğŸ“š é™„å½•
- [é”™è¯¯ç è¯´æ˜](#é”™è¯¯ç è¯´æ˜)
  - HTTPçŠ¶æ€ç 
  - é”™è¯¯å“åº”æ ¼å¼
- [WebSocket äº‹ä»¶ç±»å‹è¯¦è§£](#websocket-äº‹ä»¶ç±»å‹è¯¦è§£)
  - å³æ—¶æ¶ˆæ¯é€šçŸ¥
  - ä¼šè¯åˆ›å»ºé€šçŸ¥
  - ç”¨æˆ·çŠ¶æ€å˜æ›´é€šçŸ¥
  - å¹¿æ’­é€šçŸ¥
  - è¿æ¥ç®¡ç†äº‹ä»¶
- [å¼€å‘è¯´æ˜](#å¼€å‘è¯´æ˜)
  - ç¯å¢ƒè¦æ±‚
  - æœ¬åœ°å¼€å‘
  - APIæ–‡æ¡£

---

## ğŸ†• ç‰ˆæœ¬æ›´æ–° (v1.0.1)

### æ–°å¢åŠŸèƒ½
- **æœªè¯»æ¶ˆæ¯è®¡æ•°**: ä¼šè¯åˆ—è¡¨APIç°åœ¨åŒ…å« `unread_count` å­—æ®µï¼Œæ˜¾ç¤ºæ¯ä¸ªä¼šè¯çš„æœªè¯»æ¶ˆæ¯æ•°é‡
- **æ–‡ä»¶æ¶ˆæ¯å®Œæ•´æ¨é€**: WebSocketæ–‡ä»¶æ¶ˆæ¯ç°åœ¨åŒ…å«å®Œæ•´çš„ `file_info` å¯¹è±¡ï¼Œå®¢æˆ·ç«¯å¯ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…
- **æ–‡ä»¶ä¸‹è½½æƒé™**: è‡ªåŠ¨ä¸ºä¼šè¯æˆå‘˜åˆ›å»ºæ–‡ä»¶åˆ†äº«æƒé™ï¼Œç¡®ä¿æ–‡ä»¶ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- **ç”¨æˆ·ä½“éªŒå¢å¼º**: ç”¨æˆ·ç™»å½•åå¯ç›´æ¥åœ¨ä¼šè¯åˆ—è¡¨ä¸­çœ‹åˆ°ç¦»çº¿æœŸé—´æ”¶åˆ°çš„æœªè¯»æ¶ˆæ¯æ•°ï¼Œæ— éœ€é¢å¤–APIè°ƒç”¨

### å½±å“çš„API
- `GET /api/v1/conversations/` - å“åº”ä¸­æ–°å¢ `unread_count` å­—æ®µ
- `POST /api/v1/messages/file` - è‡ªåŠ¨åˆ›å»ºæ–‡ä»¶åˆ†äº«æƒé™
- **WebSocketæ¶ˆæ¯æ¨é€** - æ–‡ä»¶æ¶ˆæ¯æ–°å¢ `file_info` å®Œæ•´å¯¹è±¡

### å®¢æˆ·ç«¯æ›´æ–°å»ºè®®
1. **ä¼šè¯åˆ—è¡¨**: æ›´æ–°UIæ˜¾ç¤ºæœªè¯»æ¶ˆæ¯è®¡æ•°å¾½ç« 
2. **æ–‡ä»¶æ¶ˆæ¯**: åˆ©ç”¨WebSocketæ¨é€çš„ `file_info` ç›´æ¥æ˜¾ç¤ºæ–‡ä»¶è¯¦æƒ…ï¼Œæ— éœ€é¢å¤–APIè°ƒç”¨
3. **ä¸‹è½½åŠŸèƒ½**: ä½¿ç”¨ `/api/v1/files/download/{file_id}` è¿›è¡Œæ–‡ä»¶ä¸‹è½½
4. **é”™è¯¯å¤„ç†**: å¦‚ `file_info` ä¸ºç©ºï¼Œå›é€€åˆ° `/api/v1/files/info/{file_id}` è·å–æ–‡ä»¶ä¿¡æ¯
5. åˆ é™¤åŸæœ‰çš„å•ç‹¬è·å–æœªè¯»æ•°çš„å†—ä½™è°ƒç”¨ï¼ˆå¦‚éœ€è¦ä»å¯ä¿ç•™ä½œä¸ºè¡¥å……ï¼‰

---

## åŸºç¡€ä¿¡æ¯

- **Base URL**: `http://172.19.103.122:8000`
- **API Version**: v1
- **API Prefix**: `/api/v1`
- **è®¤è¯æ–¹å¼**: Bearer Token (JWT)

## è®¤è¯è¯´æ˜

é™¤äº†ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æ¥å£å¤–ï¼Œæ‰€æœ‰APIéƒ½éœ€è¦åœ¨è¯·æ±‚å¤´ä¸­åŒ…å«è®¤è¯ä»¤ç‰Œï¼š

```
Authorization: Bearer <your_jwt_token>
```

---

## 1. è®¤è¯æ¨¡å— (auth)

### 1.1 ç”¨æˆ·ç™»å½•

**æ¥å£**: `POST /api/v1/auth/login/access-token`

**æè¿°**: ç”¨æˆ·ç™»å½•è·å–è®¿é—®ä»¤ç‰Œ

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/x-www-form-urlencoded`
- **Body**:
  - `username` (string, å¿…å¡«): ç”¨æˆ·æ ‡å‡†ID
  - `password` (string, å¿…å¡«): ç”¨æˆ·å¯†ç 

**å“åº”æ•°æ®**:
```json
{
  "access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",
  "token_type": "bearer"
}
```

**å“åº”å­—æ®µ**:
- `access_token` (string): JWTè®¿é—®ä»¤ç‰Œ
- `token_type` (string): ä»¤ç‰Œç±»å‹ï¼Œå›ºå®šä¸º"bearer"

**çŠ¶æ€ç **:
- `200`: ç™»å½•æˆåŠŸ
- `400`: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯
- `422`: è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥

---

## 2. ç”¨æˆ·æ¨¡å— (users)

### 2.1 åˆ›å»ºç”¨æˆ·

**æ¥å£**: `POST /api/v1/users/`

**æè¿°**: æ³¨å†Œæ–°ç”¨æˆ·

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "standard_id": "string",
  "name": "string", 
  "password": "string"
}
```

**è¯·æ±‚å­—æ®µ**:
- `standard_id` (string, å¿…å¡«): ç”¨æˆ·æ ‡å‡†IDï¼Œé•¿åº¦1-20å­—ç¬¦ï¼Œå”¯ä¸€
- `name` (string, å¿…å¡«): ç”¨æˆ·å§“åï¼Œé•¿åº¦1-100å­—ç¬¦
- `password` (string, å¿…å¡«): ç”¨æˆ·å¯†ç ï¼Œæœ€å°‘6å­—ç¬¦

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "standard_id": "test123",
  "name": "æµ‹è¯•ç”¨æˆ·",
  "is_active": true
}
```

**å“åº”å­—æ®µ**:
- `id` (integer): ç”¨æˆ·ID
- `standard_id` (string): ç”¨æˆ·æ ‡å‡†ID
- `name` (string): ç”¨æˆ·å§“å
- `is_active` (boolean): æ˜¯å¦æ¿€æ´»

**çŠ¶æ€ç **:
- `200`: åˆ›å»ºæˆåŠŸ
- `400`: ç”¨æˆ·å·²å­˜åœ¨
- `422`: è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥

### 2.2 è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯

**æ¥å£**: `GET /api/v1/users/me`

**æè¿°**: è·å–å½“å‰ç™»å½•ç”¨æˆ·çš„ä¿¡æ¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "standard_id": "test123",
  "name": "æµ‹è¯•ç”¨æˆ·",
  "is_active": true
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯
- `403`: è®¤è¯å¤±è´¥

### 2.3 æœç´¢ç”¨æˆ·

**æ¥å£**: `GET /api/v1/users/search`

**æè¿°**: æ ¹æ®å…³é”®è¯æœç´¢ç”¨æˆ·

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `keyword` (string, å¯é€‰): æœç´¢å…³é”®è¯ï¼Œé»˜è®¤ä¸ºç©º
  - `limit` (integer, å¯é€‰): è¿”å›ç»“æœæ•°é‡é™åˆ¶ï¼Œé»˜è®¤10ï¼ŒèŒƒå›´1-50

**å“åº”æ•°æ®**:
```json
[
  {
    "id": 1,
    "standard_id": "test123",
    "name": "æµ‹è¯•ç”¨æˆ·",
    "is_active": true
  }
]
```

**çŠ¶æ€ç **:
- `200`: æœç´¢æˆåŠŸ
- `401`: æœªè®¤è¯

### 2.4 è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€

**æ¥å£**: `POST /api/v1/users/statuses`

**æè¿°**: æ‰¹é‡è·å–ç”¨æˆ·åœ¨çº¿çŠ¶æ€

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "user_ids": [1, 2, 3]
}
```

**è¯·æ±‚å­—æ®µ**:
- `user_ids` (array[integer], å¿…å¡«): ç”¨æˆ·IDåˆ—è¡¨

**å“åº”æ•°æ®**:
```json
{
  "statuses": {
    "1": true,
    "2": false,
    "3": true
  }
}
```

**å“åº”å­—æ®µ**:
- `statuses` (object): ç”¨æˆ·IDåˆ°åœ¨çº¿çŠ¶æ€çš„æ˜ å°„ï¼Œtrueè¡¨ç¤ºåœ¨çº¿ï¼Œfalseè¡¨ç¤ºç¦»çº¿

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

---

## 3. ä¼šè¯æ¨¡å— (conversations)

### 3.1 åˆ›å»ºå•èŠ

**æ¥å£**: `POST /api/v1/conversations/single`

**æè¿°**: åˆ›å»ºå•äººä¼šè¯

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "target_user_id": 2
}
```

**è¯·æ±‚å­—æ®µ**:
- `target_user_id` (integer, å¿…å¡«): ç›®æ ‡ç”¨æˆ·ID

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "name": null,
  "type": "single",
  "description": null,
  "avatar": null,
  "max_members": 2,
  "allow_invite": true,
  "allow_member_modify": false,
  "status": "active",
  "creator_id": 1,
  "created_at": "2025-01-08T10:00:00Z",
  "updated_at": "2025-01-08T10:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: åˆ›å»ºæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯æˆ–ç”¨æˆ·ä¸å­˜åœ¨
- `401`: æœªè®¤è¯

### 3.2 åˆ›å»ºç¾¤èŠ

**æ¥å£**: `POST /api/v1/conversations/group`

**æè¿°**: åˆ›å»ºç¾¤ç»„ä¼šè¯

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "name": "æµ‹è¯•ç¾¤ç»„",
  "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç¾¤ç»„",
  "member_ids": [2, 3, 4],
  "max_members": 500,
  "allow_invite": true,
  "allow_member_modify": false
}
```

**è¯·æ±‚å­—æ®µ**:
- `name` (string, å¿…å¡«): ç¾¤ç»„åç§°ï¼Œé•¿åº¦1-100å­—ç¬¦
- `description` (string, å¯é€‰): ç¾¤ç»„æè¿°
- `member_ids` (array[integer], å¿…å¡«): åˆå§‹æˆå‘˜IDåˆ—è¡¨ï¼Œè‡³å°‘1ä¸ª
- `max_members` (integer, å¯é€‰): æœ€å¤§æˆå‘˜æ•°ï¼Œé»˜è®¤500ï¼ŒèŒƒå›´2-1000
- `allow_invite` (boolean, å¯é€‰): æ˜¯å¦å…è®¸é‚€è¯·æ–°æˆå‘˜ï¼Œé»˜è®¤true
- `allow_member_modify` (boolean, å¯é€‰): æ˜¯å¦å…è®¸æˆå‘˜ä¿®æ”¹ç¾¤ä¿¡æ¯ï¼Œé»˜è®¤false

**å“åº”æ•°æ®**: åŒåˆ›å»ºå•èŠå“åº”æ ¼å¼

**çŠ¶æ€ç **:
- `200`: åˆ›å»ºæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯

### 3.3 è·å–ç”¨æˆ·ä¼šè¯åˆ—è¡¨

**æ¥å£**: `GET /api/v1/conversations/`

**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„ä¼šè¯åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `skip` (integer, å¯é€‰): è·³è¿‡çš„è®°å½•æ•°ï¼Œé»˜è®¤0
  - `limit` (integer, å¯é€‰): è¿”å›çš„è®°å½•æ•°ï¼Œé»˜è®¤20

**å“åº”æ•°æ®**:
```json
{
  "conversations": [
    {
      "id": 1,
      "name": "æµ‹è¯•ç¾¤ç»„",
      "type": "group",
      "status": "active",
      "creator_id": 1,
      "created_at": "2025-01-08T10:00:00Z",
      "updated_at": "2025-01-08T10:00:00Z",
      "member_count": 3,
      "unread_count": 5,
      "last_message_at": "2025-01-08T11:00:00Z",
      "participants": [
        {
          "id": 2,
          "standard_id": "user002",
          "name": "å…¶ä»–ç”¨æˆ·"
        }
      ]
    }
  ],
  "total": 1,
  "page": 1,
  "page_size": 20
}
```

**å“åº”å­—æ®µè¯´æ˜**:
- `conversations` (array): ä¼šè¯åˆ—è¡¨
  - `id` (integer): ä¼šè¯ID
  - `name` (string): ä¼šè¯åç§°ï¼ˆç¾¤èŠæ—¶æ˜¾ç¤ºï¼‰
  - `type` (string): ä¼šè¯ç±»å‹ï¼Œ"single"ï¼ˆå•èŠï¼‰æˆ–"group"ï¼ˆç¾¤èŠï¼‰
  - `status` (string): ä¼šè¯çŠ¶æ€
  - `creator_id` (integer): åˆ›å»ºè€…ç”¨æˆ·ID
  - `created_at` (string): åˆ›å»ºæ—¶é—´
  - `updated_at` (string): æ›´æ–°æ—¶é—´
  - `member_count` (integer): æˆå‘˜æ•°é‡
  - `unread_count` (integer): **æœªè¯»æ¶ˆæ¯æ•°é‡**ï¼ˆæ–°å¢å­—æ®µï¼‰
  - `last_message_at` (string): æœ€æ–°æ¶ˆæ¯æ—¶é—´
  - `participants` (array): å‚ä¸è€…åˆ—è¡¨ï¼ˆæ’é™¤å½“å‰ç”¨æˆ·ï¼‰
- `total` (integer): æ€»è®°å½•æ•°
- `page` (integer): å½“å‰é¡µç 
- `page_size` (integer): æ¯é¡µå¤§å°

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 3.4 è·å–ä¼šè¯è¯¦æƒ…

**æ¥å£**: `GET /api/v1/conversations/{conversation_id}`

**æè¿°**: è·å–æŒ‡å®šä¼šè¯çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID

**å“åº”æ•°æ®**: åŒåˆ›å»ºä¼šè¯å“åº”æ ¼å¼

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™è®¿é—®

### 3.5 æ›´æ–°ä¼šè¯ä¿¡æ¯

**æ¥å£**: `PUT /api/v1/conversations/{conversation_id}`

**æè¿°**: æ›´æ–°ä¼šè¯ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "name": "æ–°çš„ç¾¤ç»„åç§°",
  "description": "æ–°çš„ç¾¤ç»„æè¿°",
  "avatar": "avatar_url",
  "max_members": 600,
  "allow_invite": false,
  "allow_member_modify": true
}
```

**è¯·æ±‚å­—æ®µ** (æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„):
- `name` (string): ä¼šè¯åç§°
- `description` (string): ä¼šè¯æè¿°
- `avatar` (string): ä¼šè¯å¤´åƒURL
- `max_members` (integer): æœ€å¤§æˆå‘˜æ•°
- `allow_invite` (boolean): æ˜¯å¦å…è®¸é‚€è¯·
- `allow_member_modify` (boolean): æ˜¯å¦å…è®¸æˆå‘˜ä¿®æ”¹

**å“åº”æ•°æ®**: åŒåˆ›å»ºä¼šè¯å“åº”æ ¼å¼

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 3.6 åˆ é™¤ä¼šè¯

**æ¥å£**: `DELETE /api/v1/conversations/{conversation_id}`

**æè¿°**: åˆ é™¤æŒ‡å®šä¼šè¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `204`: åˆ é™¤æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 3.7 è·å–ä¼šè¯æˆå‘˜

**æ¥å£**: `GET /api/v1/conversations/{conversation_id}/members`

**æè¿°**: è·å–æŒ‡å®šä¼šè¯çš„æˆå‘˜åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID

**å“åº”æ•°æ®**:
```json
{
  "members": [
    {
      "id": 1,
      "conversation_id": 1,
      "user_id": 1,
      "role": "admin",
      "status": "active",
      "joined_at": "2025-01-08T10:00:00Z",
      "user_name": "ç®¡ç†å‘˜",
      "user_standard_id": "admin123"
    }
  ],
  "total": 1
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 3.8 æ·»åŠ ä¼šè¯æˆå‘˜

**æ¥å£**: `POST /api/v1/conversations/{conversation_id}/members`

**æè¿°**: å‘ä¼šè¯æ·»åŠ æ–°æˆå‘˜

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "user_ids": [5, 6, 7],
  "role": "member"
}
```

**è¯·æ±‚å­—æ®µ**:
- `user_ids` (array[integer], å¿…å¡«): è¦æ·»åŠ çš„ç”¨æˆ·IDåˆ—è¡¨
- `role` (string, å¯é€‰): æˆå‘˜è§’è‰²ï¼Œé»˜è®¤"member"

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ·»åŠ æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 3.9 ç§»é™¤ä¼šè¯æˆå‘˜

**æ¥å£**: `DELETE /api/v1/conversations/{conversation_id}/members/{user_id}`

**æè¿°**: ä»ä¼šè¯ä¸­ç§»é™¤æŒ‡å®šæˆå‘˜

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
  - `user_id` (integer, å¿…å¡«): ç”¨æˆ·ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `204`: ç§»é™¤æˆåŠŸ
- `404`: ä¼šè¯æˆ–ç”¨æˆ·ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 3.10 æ›´æ–°ä¼šè¯æˆå‘˜ä¿¡æ¯

**æ¥å£**: `PUT /api/v1/conversations/{conversation_id}/members/{user_id}`

**æè¿°**: æ›´æ–°ä¼šè¯æˆå‘˜çš„ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
  - `user_id` (integer, å¿…å¡«): ç”¨æˆ·ID
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "role": "admin",
  "nickname": "æ–°æ˜µç§°",
  "status": "active",
  "muted_until": "2025-01-10T10:00:00Z"
}
```

**è¯·æ±‚å­—æ®µ** (æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¯é€‰çš„):
- `role` (string): æˆå‘˜è§’è‰²
- `nickname` (string): ç¾¤å†…æ˜µç§°
- `status` (string): æˆå‘˜çŠ¶æ€
- `muted_until` (string): ç¦è¨€åˆ°æœŸæ—¶é—´

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `404`: ä¼šè¯æˆ–ç”¨æˆ·ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 4. æ¶ˆæ¯æ¨¡å— (messages)

### 4.1 å‘é€æ–‡æœ¬æ¶ˆæ¯

**æ¥å£**: `POST /api/v1/messages/text`

**æè¿°**: å‘é€æ–‡æœ¬æ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "conversation_id": 1,
  "content": "Hello, world!",
  "reply_to_id": 10
}
```

**è¯·æ±‚å­—æ®µ**:
- `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- `content` (string, å¿…å¡«): æ¶ˆæ¯å†…å®¹ï¼Œé•¿åº¦1-5000å­—ç¬¦
- `reply_to_id` (integer, å¯é€‰): å›å¤çš„æ¶ˆæ¯ID

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "conversation_id": 1,
  "sender_id": 1,
  "message_type": "text",
  "content": "Hello, world!",
  "status": "sent",
  "reply_to_id": 10,
  "created_at": "2025-01-08T12:00:00Z",
  "updated_at": "2025-01-08T12:00:00Z",
  "sender_name": "ç”¨æˆ·å",
  "sender_standard_id": "user123"
}
```

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.2 å‘é€æ–‡ä»¶æ¶ˆæ¯

**æ¥å£**: `POST /api/v1/messages/file`

**æè¿°**: å‘é€æ–‡ä»¶æ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "conversation_id": 1,
  "file_id": "file_uuid_123",
  "file_name": "document.pdf",
  "file_size": 1024000,
  "content": "è¿™æ˜¯ä¸€ä¸ªPDFæ–‡ä»¶",
  "reply_to_id": 10
}
```

**è¯·æ±‚å­—æ®µ**:
- `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- `file_id` (string, å¿…å¡«): æ–‡ä»¶ID
- `file_name` (string, å¿…å¡«): æ–‡ä»¶å
- `file_size` (integer, å¿…å¡«): æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
- `content` (string, å¯é€‰): æ–‡ä»¶æè¿°
- `reply_to_id` (integer, å¯é€‰): å›å¤çš„æ¶ˆæ¯ID

**å“åº”æ•°æ®**:
```json
{
  "id": 123,
  "conversation_id": 1,
  "sender_id": 1,
  "message_type": "file",
  "content": "è¿™æ˜¯ä¸€ä¸ªPDFæ–‡ä»¶",
  "status": "sent",
  "reply_to_id": 10,
  "created_at": "2025-01-15T12:00:00Z",
  "updated_at": "2025-01-15T12:00:00Z",
  "sender_name": "ç”¨æˆ·å",
  "sender_standard_id": "user123",
  "file_info": {
    "id": 456,
    "file_id": "d4b64371-0d7b-4f6b-b97b-34bd6aa6ab10",
    "name": "document.pdf",
    "path": "2025/01/15/user_1/d4b64371-0d7b-4f6b-b97b-34bd6aa6ab10.pdf",
    "size": 1024000,
    "type": "application/pdf"
  }
}
```

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `404`: ä¼šè¯æˆ–æ–‡ä»¶ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.3 å‘é€ä½ç½®æ¶ˆæ¯

**æ¥å£**: `POST /api/v1/messages/location`

**æè¿°**: å‘é€ä½ç½®æ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "conversation_id": 1,
  "latitude": "39.9042",
  "longitude": "116.4074",
  "address": "åŒ—äº¬å¸‚æœé˜³åŒº",
  "reply_to_id": 10
}
```

**è¯·æ±‚å­—æ®µ**:
- `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- `latitude` (string, å¿…å¡«): çº¬åº¦
- `longitude` (string, å¿…å¡«): ç»åº¦
- `address` (string, å¯é€‰): åœ°å€æè¿°
- `reply_to_id` (integer, å¯é€‰): å›å¤çš„æ¶ˆæ¯ID

**å“åº”æ•°æ®**: åŒå‘é€æ–‡æœ¬æ¶ˆæ¯å“åº”æ ¼å¼ï¼Œä½†åŒ…å«ä½ç½®ä¿¡æ¯

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.4 æœç´¢æ¶ˆæ¯

**æ¥å£**: `GET /api/v1/messages/search`

**æè¿°**: æœç´¢æ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `keyword` (string, å¿…å¡«): æœç´¢å…³é”®è¯
  - `conversation_id` (integer, å¯é€‰): ä¼šè¯ID
  - `message_type` (string, å¯é€‰): æ¶ˆæ¯ç±»å‹
  - `limit` (integer, å¯é€‰): ç»“æœæ•°é‡é™åˆ¶ï¼Œé»˜è®¤20

**å“åº”æ•°æ®**:
```json
{
  "messages": [
    {
      "id": 1,
      "conversation_id": 1,
      "sender_id": 1,
      "message_type": "text",
      "content": "Hello, world!",
      "status": "sent",
      "created_at": "2025-01-08T12:00:00Z",
      "sender_name": "ç”¨æˆ·å"
    }
  ],
  "total": 1,
  "limit": 20
}
```

**çŠ¶æ€ç **:
- `200`: æœç´¢æˆåŠŸ
- `401`: æœªè®¤è¯

### 4.5 è·å–æœªè¯»æ¶ˆæ¯æ•°

**æ¥å£**: `GET /api/v1/messages/unread/count`

**æè¿°**: è·å–æœªè¯»æ¶ˆæ¯æ•°é‡

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `conversation_id` (integer, å¯é€‰): ä¼šè¯IDï¼Œä¸æä¾›åˆ™è·å–æ‰€æœ‰æœªè¯»æ•°

**å“åº”æ•°æ®**:
```json
{
  "unread_count": 5,
  "conversation_id": 1
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 4.6 è·å–ä¼šè¯æ¶ˆæ¯

**æ¥å£**: `GET /api/v1/messages/conversation/{conversation_id}`

**æè¿°**: è·å–æŒ‡å®šä¼šè¯çš„æ¶ˆæ¯åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- **Query Parameters**:
  - `limit` (integer, å¯é€‰): æ¶ˆæ¯æ•°é‡é™åˆ¶ï¼Œé»˜è®¤20
  - `before_cursor` (string, å¯é€‰): å‘å‰åˆ†é¡µæ¸¸æ ‡
  - `after_cursor` (string, å¯é€‰): å‘ååˆ†é¡µæ¸¸æ ‡

**å“åº”æ•°æ®**:
```json
{
  "messages": [
    {
      "id": 1,
      "conversation_id": 1,
      "sender_id": 1,
      "message_type": "text",
      "content": "Hello, world!",
      "status": "sent",
      "created_at": "2025-01-08T12:00:00Z",
      "sender_name": "ç”¨æˆ·å"
    }
  ],
  "has_more": true,
  "limit": 20
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.7 è·å–å•æ¡æ¶ˆæ¯

**æ¥å£**: `GET /api/v1/messages/single/{message_id}`

**æè¿°**: è·å–æŒ‡å®šæ¶ˆæ¯çš„è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `message_id` (integer, å¿…å¡«): æ¶ˆæ¯ID

**å“åº”æ•°æ®**: åŒæ¶ˆæ¯å“åº”æ ¼å¼

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: æ¶ˆæ¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.8 æ›´æ–°æ¶ˆæ¯

**æ¥å£**: `PUT /api/v1/messages/{message_id}`

**æè¿°**: æ›´æ–°æ¶ˆæ¯å†…å®¹

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `message_id` (integer, å¿…å¡«): æ¶ˆæ¯ID
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "content": "æ›´æ–°åçš„æ¶ˆæ¯å†…å®¹",
  "status": "edited"
}
```

**è¯·æ±‚å­—æ®µ**:
- `content` (string, å¯é€‰): æ¶ˆæ¯å†…å®¹
- `status` (string, å¯é€‰): æ¶ˆæ¯çŠ¶æ€

**å“åº”æ•°æ®**: åŒæ¶ˆæ¯å“åº”æ ¼å¼

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `404`: æ¶ˆæ¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.9 æ’¤å›æ¶ˆæ¯

**æ¥å£**: `POST /api/v1/messages/{message_id}/recall`

**æè¿°**: æ’¤å›æŒ‡å®šæ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `message_id` (integer, å¿…å¡«): æ¶ˆæ¯ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ’¤å›æˆåŠŸ
- `404`: æ¶ˆæ¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™æˆ–è¶…æ—¶

### 4.10 æ ‡è®°æ¶ˆæ¯å·²è¯»

**æ¥å£**: `POST /api/v1/messages/mark-read`

**æè¿°**: æ ‡è®°æ¶ˆæ¯ä¸ºå·²è¯»

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "conversation_id": 1,
  "message_ids": [1, 2, 3]
}
```

**è¯·æ±‚å­—æ®µ**:
- `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- `message_ids` (array[integer], å¿…å¡«): æ¶ˆæ¯IDåˆ—è¡¨

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ ‡è®°æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.11 è·å–æ¶ˆæ¯å·²è¯»å›æ‰§

**æ¥å£**: `GET /api/v1/messages/{message_id}/read-receipts`

**æè¿°**: è·å–æ¶ˆæ¯çš„å·²è¯»å›æ‰§ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `message_id` (integer, å¿…å¡«): æ¶ˆæ¯ID

**å“åº”æ•°æ®**:
```json
{
  "receipts": [
    {
      "id": 1,
      "message_id": 1,
      "user_id": 2,
      "read_at": "2025-01-08T12:30:00Z"
    }
  ],
  "total": 1
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: æ¶ˆæ¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 4.12 å‘é€æ­£åœ¨è¾“å…¥æŒ‡ç¤º

**æ¥å£**: `POST /api/v1/messages/typing`

**æè¿°**: å‘é€æ­£åœ¨è¾“å…¥çŠ¶æ€æŒ‡ç¤º

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "conversation_id": 1,
  "is_typing": true
}
```

**è¯·æ±‚å­—æ®µ**:
- `conversation_id` (integer, å¿…å¡«): ä¼šè¯ID
- `is_typing` (boolean, å¯é€‰): æ˜¯å¦æ­£åœ¨è¾“å…¥ï¼Œé»˜è®¤true

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `404`: ä¼šè¯ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 5. æ–‡ä»¶æ¨¡å— (files)

### 5.1 ä¸Šä¼ æ–‡ä»¶

**æ¥å£**: `POST /api/v1/files/upload`

**æè¿°**: ä¸Šä¼ æ–‡ä»¶

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `multipart/form-data`
- **Form Data**:
  - `file` (file, å¿…å¡«): è¦ä¸Šä¼ çš„æ–‡ä»¶
  - `description` (string, å¯é€‰): æ–‡ä»¶æè¿°
  - `is_public` (boolean, å¯é€‰): æ˜¯å¦ä¸ºå…¬å…±æ–‡ä»¶ï¼Œé»˜è®¤false

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "file_id": "uuid-123-456",
  "file_name": "document.pdf",
  "file_path": "/uploads/2025/01/08/document.pdf",
  "file_size": 1024000,
  "file_type": "application/pdf",
  "uploaded_at": "2025-01-08T13:00:00Z",
  "uploader_id": 1
}
```

**çŠ¶æ€ç **:
- `200`: ä¸Šä¼ æˆåŠŸ
- `400`: æ–‡ä»¶æ ¼å¼ä¸æ”¯æŒæˆ–å¤§å°è¶…é™
- `401`: æœªè®¤è¯

### 5.2 ä¸‹è½½æ–‡ä»¶

**æ¥å£**: `GET /api/v1/files/download/{file_id}`

**æè¿°**: ä¸‹è½½æ–‡ä»¶

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `file_id` (string, å¿…å¡«): æ–‡ä»¶ID

**å“åº”æ•°æ®**: æ–‡ä»¶äºŒè¿›åˆ¶å†…å®¹

**çŠ¶æ€ç **:
- `200`: ä¸‹è½½æˆåŠŸ
- `404`: æ–‡ä»¶ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 5.3 è·å–æ–‡ä»¶ä¿¡æ¯

**æ¥å£**: `GET /api/v1/files/info/{file_id}`

**æè¿°**: è·å–æ–‡ä»¶è¯¦ç»†ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `file_id` (string, å¿…å¡«): æ–‡ä»¶ID

**å“åº”æ•°æ®**:
```json
{
  "file_id": "uuid-123-456",
  "file_name": "document.pdf",
  "file_path": "/uploads/2025/01/08/document.pdf",
  "file_size": 1024000,
  "file_type": "application/pdf",
  "is_public": false,
  "uploader_id": 1,
  "uploaded_at": "2025-01-08T13:00:00Z",
  "download_count": 5
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: æ–‡ä»¶ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 5.4 è·å–ç”¨æˆ·æ–‡ä»¶åˆ—è¡¨

**æ¥å£**: `GET /api/v1/files/list`

**æè¿°**: è·å–å½“å‰ç”¨æˆ·çš„æ–‡ä»¶åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `page` (integer, å¯é€‰): é¡µç ï¼Œé»˜è®¤1
  - `page_size` (integer, å¯é€‰): æ¯é¡µå¤§å°ï¼Œé»˜è®¤20

**å“åº”æ•°æ®**:
```json
{
  "files": [
    {
      "file_id": "uuid-123-456",
      "file_name": "document.pdf",
      "file_size": 1024000,
      "file_type": "application/pdf",
      "uploaded_at": "2025-01-08T13:00:00Z"
    }
  ],
  "total": 1,
  "page": 1,
  "page_size": 20
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 5.5 åˆ é™¤æ–‡ä»¶

**æ¥å£**: `DELETE /api/v1/files/{file_id}`

**æè¿°**: åˆ é™¤æ–‡ä»¶

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `file_id` (string, å¿…å¡«): æ–‡ä»¶ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `204`: åˆ é™¤æˆåŠŸ
- `404`: æ–‡ä»¶ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 5.6 è·å–æ–‡ä»¶ä¸‹è½½ä¿¡æ¯

**æ¥å£**: `GET /api/v1/files/download-info/{file_id}`

**æè¿°**: è·å–æ–‡ä»¶ä¸‹è½½ä¿¡æ¯ï¼ˆä¸ç›´æ¥ä¸‹è½½æ–‡ä»¶ï¼‰

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `file_id` (string, å¿…å¡«): æ–‡ä»¶ID

**å“åº”æ•°æ®**:
```json
{
  "file_id": "uuid-123-456",
  "file_name": "document.pdf",
  "file_size": 1024000,
  "file_type": "application/pdf",
  "download_url": "/api/v1/files/download/uuid-123-456"
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: æ–‡ä»¶ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 6. å®æ—¶é€šä¿¡æ¨¡å— (realtime)

### 6.1 è·å–åœ¨çº¿ç”¨æˆ·

**æ¥å£**: `GET /api/v1/realtime/online-users`

**æè¿°**: è·å–å½“å‰åœ¨çº¿ç”¨æˆ·åˆ—è¡¨

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "online_users": [1, 2, 3, 5],
  "count": 4
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 6.2 æ£€æŸ¥ç”¨æˆ·åœ¨çº¿çŠ¶æ€

**æ¥å£**: `GET /api/v1/realtime/user-status/{user_id}`

**æè¿°**: æ£€æŸ¥æŒ‡å®šç”¨æˆ·çš„åœ¨çº¿çŠ¶æ€

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `user_id` (integer, å¿…å¡«): ç”¨æˆ·ID

**å“åº”æ•°æ®**:
```json
{
  "user_id": 1,
  "is_online": true,
  "last_seen": "2025-01-08T14:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: ç”¨æˆ·ä¸å­˜åœ¨
- `401`: æœªè®¤è¯

### 6.3 å‘é€å¹¿æ’­æ¶ˆæ¯

**æ¥å£**: `POST /api/v1/realtime/broadcast`

**æè¿°**: å‘é€ç³»ç»Ÿå¹¿æ’­æ¶ˆæ¯

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `message` (string, å¿…å¡«): å¹¿æ’­æ¶ˆæ¯å†…å®¹
  - `broadcast_type` (string, å¯é€‰): å¹¿æ’­ç±»å‹ï¼Œé»˜è®¤"system"

**å“åº”æ•°æ®**:
```json
{
  "message": "å¹¿æ’­æ¶ˆæ¯å‘é€æˆåŠŸ",
  "recipients": 10
}
```

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 6.4 è·å–è¿æ¥ç»Ÿè®¡

**æ¥å£**: `GET /api/v1/realtime/connection-stats`

**æè¿°**: è·å–WebSocketè¿æ¥ç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "total_connections": 25,
  "authenticated_connections": 20,
  "anonymous_connections": 5
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 7. ç¾¤ç»„é«˜çº§åŠŸèƒ½ (groups)

### 7.1 æ·»åŠ ç¾¤ç»„æˆå‘˜

**æ¥å£**: `POST /api/v1/groups/{conversation_id}/members`

**æè¿°**: æ‰¹é‡æ·»åŠ ç¾¤ç»„æˆå‘˜

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ç¾¤ç»„ä¼šè¯ID
- **Query Parameters**:
  - `user_ids` (array[integer], å¿…å¡«): ç”¨æˆ·IDåˆ—è¡¨

**å“åº”æ•°æ®**: ç¾¤ç»„ä¼šè¯ä¿¡æ¯

**çŠ¶æ€ç **:
- `200`: æ·»åŠ æˆåŠŸ
- `404`: ç¾¤ç»„ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 7.2 ç§»é™¤ç¾¤ç»„æˆå‘˜

**æ¥å£**: `DELETE /api/v1/groups/{conversation_id}/members/{user_id}`

**æè¿°**: ç§»é™¤ç¾¤ç»„æˆå‘˜

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ç¾¤ç»„ä¼šè¯ID
  - `user_id` (integer, å¿…å¡«): ç”¨æˆ·ID

**å“åº”æ•°æ®**: ç¾¤ç»„ä¼šè¯ä¿¡æ¯

**çŠ¶æ€ç **:
- `200`: ç§»é™¤æˆåŠŸ
- `404`: ç¾¤ç»„æˆ–ç”¨æˆ·ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 7.3 ç”Ÿæˆç¾¤ç»„é‚€è¯·ç 

**æ¥å£**: `POST /api/v1/groups/{conversation_id}/invite-code`

**æè¿°**: ç”Ÿæˆç¾¤ç»„é‚€è¯·ç 

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ç¾¤ç»„ä¼šè¯ID

**å“åº”æ•°æ®**:
```json
{
  "invite_code": "ABC123DEF",
  "expires_at": "2025-01-15T10:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: ç”ŸæˆæˆåŠŸ
- `404`: ç¾¤ç»„ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 7.4 è·å–ç¾¤ç»„ç»Ÿè®¡ä¿¡æ¯

**æ¥å£**: `GET /api/v1/groups/{conversation_id}/stats`

**æè¿°**: è·å–ç¾¤ç»„ç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `conversation_id` (integer, å¿…å¡«): ç¾¤ç»„ä¼šè¯ID

**å“åº”æ•°æ®**:
```json
{
  "member_count": 25,
  "message_count": 1500,
  "active_members": 20,
  "created_at": "2025-01-01T00:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: ç¾¤ç»„ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 7.5 æœç´¢å…¬å¼€ç¾¤ç»„

**æ¥å£**: `GET /api/v1/groups/search`

**æè¿°**: æœç´¢å…¬å¼€ç¾¤ç»„

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `keyword` (string, å¿…å¡«): æœç´¢å…³é”®è¯
  - `limit` (integer, å¯é€‰): è¿”å›æ•°é‡é™åˆ¶ï¼Œé»˜è®¤10

**å“åº”æ•°æ®**:
```json
{
  "groups": [
    {
      "id": 1,
      "name": "æŠ€æœ¯äº¤æµç¾¤",
      "description": "æŠ€æœ¯äº¤æµè®¨è®º",
      "member_count": 150,
      "avatar": "group_avatar_url"
    }
  ],
  "total": 1
}
```

**çŠ¶æ€ç **:
- `200`: æœç´¢æˆåŠŸ
- `401`: æœªè®¤è¯

---

## 8. WebSocket å®æ—¶è¿æ¥

### WebSocketè¿æ¥åœ°å€

`ws://172.19.103.122:8000/ws/{user_id}`

### è®¤è¯

WebSocketè¿æ¥éœ€è¦åœ¨è¿æ¥æ—¶æä¾›JWT tokenä½œä¸ºæŸ¥è¯¢å‚æ•°ï¼š

`ws://172.19.103.122:8000/ws/{user_id}?token={jwt_token}`

### æ¶ˆæ¯æ ¼å¼

**æ¥æ”¶æ¶ˆæ¯**:
```json
{
  "type": "message",
  "data": {
    "id": 1,
    "conversation_id": 1,
    "sender_id": 2,
    "content": "Hello!",
    "message_type": "text",
    "created_at": "2025-01-08T16:00:00Z"
  }
}
```

**å‘é€æ¶ˆæ¯**:
```json
{
  "type": "message",
  "conversation_id": 1,
  "content": "Hello!",
  "message_type": "text"
}
```

### äº‹ä»¶ç±»å‹è¯¦è§£

è¯¦ç»†çš„WebSocketäº‹ä»¶ç±»å‹è¯·å‚è§æœ¬æ–‡æ¡£åç»­çš„[WebSocketäº‹ä»¶ç±»å‹è¯¦è§£](#websocket-äº‹ä»¶ç±»å‹è¯¦è§£)éƒ¨åˆ†ã€‚

### æ–‡ä»¶æ¶ˆæ¯å¤„ç†æŒ‡å—

**ğŸ”— æ–‡ä»¶æ¶ˆæ¯å®Œæ•´æ€§ä¿éšœ**

è‡ªv1.0.1ç‰ˆæœ¬èµ·ï¼ŒWebSocketæ¨é€çš„æ–‡ä»¶æ¶ˆæ¯åŒ…å«å®Œæ•´çš„`file_info`å¯¹è±¡ï¼Œå®¢æˆ·ç«¯æ— éœ€é¢å¤–APIè°ƒç”¨å³å¯è·å–ï¼š

- **æ–‡ä»¶å** (`name`): ç”¨äºæ˜¾ç¤ºå’Œä¿å­˜
- **æ–‡ä»¶å¤§å°** (`size`): ç”¨äºæ˜¾ç¤ºå’Œè¿›åº¦æ¡  
- **æ–‡ä»¶ç±»å‹** (`type`): ç”¨äºå›¾æ ‡å’Œé¢„è§ˆåˆ¤æ–­
- **æ–‡ä»¶è·¯å¾„** (`path`): ç”¨äºä¸‹è½½åœ°å€æ„å»º

**ğŸ¯ å®¢æˆ·ç«¯é›†æˆå»ºè®®**

1. **å®æ—¶æ˜¾ç¤º**: æ”¶åˆ°æ–‡ä»¶æ¶ˆæ¯åç›´æ¥ä½¿ç”¨`file_info`æ˜¾ç¤ºæ–‡ä»¶ä¿¡æ¯
2. **ä¸‹è½½å¤„ç†**: ä½¿ç”¨`file_id`æ„å»ºä¸‹è½½URLï¼š`/api/v1/files/download/{file_id}`
3. **ç¼“å­˜ç­–ç•¥**: å»ºè®®ç¼“å­˜`file_info`é¿å…é‡å¤APIè°ƒç”¨
4. **é”™è¯¯å¤„ç†**: å¦‚`file_info`ä¸ºç©ºï¼Œå›é€€åˆ°`/api/v1/files/info/{file_id}`è·å–

**ğŸ“± UIå±•ç¤ºå‚è€ƒ**

```javascript
// æ–‡ä»¶æ¶ˆæ¯UIæ¸²æŸ“ç¤ºä¾‹
function renderFileMessage(messageData) {
  const { file_info } = messageData;
  return `
    <div class="file-message">
      <div class="file-icon">${getFileIcon(file_info.type)}</div>
      <div class="file-details">
        <div class="file-name">${file_info.name}</div>
        <div class="file-size">${formatFileSize(file_info.size)}</div>
      </div>
      <a href="/api/v1/files/download/${file_info.file_id}" 
         class="download-btn">ä¸‹è½½</a>
    </div>
  `;
}
```

---

## 9. é€šçŸ¥æ¨¡å— (notifications)

### 9.1 è·å–é€šçŸ¥åˆ—è¡¨

**æ¥å£**: `GET /api/v1/notifications/`

**æè¿°**: è·å–ç”¨æˆ·é€šçŸ¥åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `page` (integer, å¯é€‰): é¡µç ï¼Œé»˜è®¤1
  - `size` (integer, å¯é€‰): æ¯é¡µæ•°é‡ï¼Œé»˜è®¤20
  - `unread_only` (boolean, å¯é€‰): ä»…æ˜¾ç¤ºæœªè¯»é€šçŸ¥ï¼Œé»˜è®¤false
  - `notification_type` (string, å¯é€‰): é€šçŸ¥ç±»å‹ç­›é€‰

**å“åº”æ•°æ®**:
```json
{
  "notifications": [
    {
      "id": 1,
      "title": "æ–°æ¶ˆæ¯",
      "content": "æ‚¨æœ‰ä¸€æ¡æ–°æ¶ˆæ¯",
      "type": "message",
      "status": "unread",
      "priority": "normal",
      "created_at": "2025-01-08T15:00:00Z"
    }
  ],
  "total": 1,
  "unread_count": 1,
  "page": 1,
  "size": 20
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 9.2 åˆ›å»ºé€šçŸ¥

**æ¥å£**: `POST /api/v1/notifications/`

**æè¿°**: åˆ›å»ºæ–°é€šçŸ¥

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "user_id": 1,
  "title": "ç³»ç»Ÿé€šçŸ¥",
  "content": "è¿™æ˜¯ä¸€æ¡ç³»ç»Ÿé€šçŸ¥",
  "type": "system",
  "priority": "high",
  "channels": ["websocket", "push"],
  "scheduled_at": "2025-01-08T16:00:00Z"
}
```

**å“åº”æ•°æ®**: é€šçŸ¥è¯¦æƒ…

**çŠ¶æ€ç **:
- `201`: åˆ›å»ºæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.3 è·å–é€šçŸ¥ç»Ÿè®¡

**æ¥å£**: `GET /api/v1/notifications/stats`

**æè¿°**: è·å–é€šçŸ¥ç»Ÿè®¡ä¿¡æ¯

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "total_notifications": 50,
  "unread_count": 5,
  "read_count": 45,
  "by_type": {
    "message": 30,
    "system": 15,
    "group_invite": 5
  },
  "by_priority": {
    "high": 5,
    "normal": 40,
    "low": 5
  }
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 9.4 è·å–å•ä¸ªé€šçŸ¥

**æ¥å£**: `GET /api/v1/notifications/{notification_id}`

**æè¿°**: è·å–æŒ‡å®šé€šçŸ¥è¯¦æƒ…

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `notification_id` (integer, å¿…å¡«): é€šçŸ¥ID

**å“åº”æ•°æ®**: é€šçŸ¥è¯¦æƒ…

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: é€šçŸ¥ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.5 æ›´æ–°é€šçŸ¥

**æ¥å£**: `PATCH /api/v1/notifications/{notification_id}`

**æè¿°**: æ›´æ–°é€šçŸ¥ä¿¡æ¯

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `notification_id` (integer, å¿…å¡«): é€šçŸ¥ID
- **Content-Type**: `application/json`
- **Body**: è¦æ›´æ–°çš„å­—æ®µ

**å“åº”æ•°æ®**: æ›´æ–°åçš„é€šçŸ¥è¯¦æƒ…

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `404`: é€šçŸ¥ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.6 åˆ é™¤é€šçŸ¥

**æ¥å£**: `DELETE /api/v1/notifications/{notification_id}`

**æè¿°**: åˆ é™¤æŒ‡å®šé€šçŸ¥

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `notification_id` (integer, å¿…å¡«): é€šçŸ¥ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `204`: åˆ é™¤æˆåŠŸ
- `404`: é€šçŸ¥ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.7 æ‰¹é‡å‘é€é€šçŸ¥

**æ¥å£**: `POST /api/v1/notifications/send`

**æè¿°**: æ‰¹é‡å‘é€é€šçŸ¥

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "user_ids": [1, 2, 3],
  "title": "ç³»ç»Ÿç»´æŠ¤é€šçŸ¥",
  "content": "ç³»ç»Ÿå°†äºä»Šæ™šè¿›è¡Œç»´æŠ¤",
  "type": "system",
  "priority": "high"
}
```

**å“åº”æ•°æ®**:
```json
{
  "total_sent": 3,
  "successful": 3,
  "failed": 0,
  "notification_ids": [1, 2, 3],
  "errors": []
}
```

**çŠ¶æ€ç **:
- `200`: å‘é€æˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.8 æ ‡è®°é€šçŸ¥å·²è¯»

**æ¥å£**: `POST /api/v1/notifications/mark-read`

**æè¿°**: æ‰¹é‡æ ‡è®°é€šçŸ¥ä¸ºå·²è¯»

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "notification_ids": [1, 2, 3]
}
```

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ ‡è®°æˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯

### 9.9 æ‰¹é‡æ“ä½œé€šçŸ¥

**æ¥å£**: `POST /api/v1/notifications/batch-action`

**æè¿°**: æ‰¹é‡æ“ä½œé€šçŸ¥

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**:
```json
{
  "notification_ids": [1, 2, 3],
  "action": "mark_read"
}
```

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `200`: æ“ä½œæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯

### 9.10 è·å–é€šçŸ¥åå¥½è®¾ç½®

**æ¥å£**: `GET /api/v1/notifications/preferences/`

**æè¿°**: è·å–ç”¨æˆ·é€šçŸ¥åå¥½è®¾ç½®

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "id": 1,
  "user_id": 1,
  "message_enabled": true,
  "group_message_enabled": true,
  "websocket_enabled": true,
  "email_enabled": true,
  "push_enabled": true,
  "do_not_disturb": false,
  "quiet_hours_start": "22:00",
  "quiet_hours_end": "08:00",
  "email_frequency": "immediate"
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯

### 9.11 æ›´æ–°é€šçŸ¥åå¥½è®¾ç½®

**æ¥å£**: `PUT /api/v1/notifications/preferences/`

**æè¿°**: æ›´æ–°ç”¨æˆ·é€šçŸ¥åå¥½è®¾ç½®

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**: è¦æ›´æ–°çš„åå¥½è®¾ç½®å­—æ®µ

**å“åº”æ•°æ®**: æ›´æ–°åçš„åå¥½è®¾ç½®

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯

### 9.12 è·å–é€šçŸ¥æ¨¡æ¿åˆ—è¡¨

**æ¥å£**: `GET /api/v1/notifications/templates/`

**æè¿°**: è·å–é€šçŸ¥æ¨¡æ¿åˆ—è¡¨

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `page` (integer, å¯é€‰): é¡µç 
  - `size` (integer, å¯é€‰): æ¯é¡µæ•°é‡
  - `notification_type` (string, å¯é€‰): é€šçŸ¥ç±»å‹ç­›é€‰
  - `active_only` (boolean, å¯é€‰): ä»…æ˜¾ç¤ºå¯ç”¨çš„æ¨¡æ¿

**å“åº”æ•°æ®**: æ¨¡æ¿åˆ—è¡¨

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.13 åˆ›å»ºé€šçŸ¥æ¨¡æ¿

**æ¥å£**: `POST /api/v1/notifications/templates/`

**æè¿°**: åˆ›å»ºæ–°çš„é€šçŸ¥æ¨¡æ¿

**è¯·æ±‚å‚æ•°**:
- **Content-Type**: `application/json`
- **Body**: æ¨¡æ¿ä¿¡æ¯

**å“åº”æ•°æ®**: åˆ›å»ºçš„æ¨¡æ¿è¯¦æƒ…

**çŠ¶æ€ç **:
- `201`: åˆ›å»ºæˆåŠŸ
- `400`: å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.14 è·å–é€šçŸ¥æ¨¡æ¿è¯¦æƒ…

**æ¥å£**: `GET /api/v1/notifications/templates/{template_id}`

**æè¿°**: è·å–æŒ‡å®šé€šçŸ¥æ¨¡æ¿è¯¦æƒ…

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `template_id` (integer, å¿…å¡«): æ¨¡æ¿ID

**å“åº”æ•°æ®**: æ¨¡æ¿è¯¦æƒ…

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `404`: æ¨¡æ¿ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.15 æ›´æ–°é€šçŸ¥æ¨¡æ¿

**æ¥å£**: `PATCH /api/v1/notifications/templates/{template_id}`

**æè¿°**: æ›´æ–°é€šçŸ¥æ¨¡æ¿

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `template_id` (integer, å¿…å¡«): æ¨¡æ¿ID
- **Content-Type**: `application/json`
- **Body**: è¦æ›´æ–°çš„æ¨¡æ¿å­—æ®µ

**å“åº”æ•°æ®**: æ›´æ–°åçš„æ¨¡æ¿è¯¦æƒ…

**çŠ¶æ€ç **:
- `200`: æ›´æ–°æˆåŠŸ
- `404`: æ¨¡æ¿ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 9.16 åˆ é™¤é€šçŸ¥æ¨¡æ¿

**æ¥å£**: `DELETE /api/v1/notifications/templates/{template_id}`

**æè¿°**: åˆ é™¤é€šçŸ¥æ¨¡æ¿

**è¯·æ±‚å‚æ•°**:
- **Path Parameters**:
  - `template_id` (integer, å¿…å¡«): æ¨¡æ¿ID

**å“åº”æ•°æ®**: æ— å†…å®¹

**çŠ¶æ€ç **:
- `204`: åˆ é™¤æˆåŠŸ
- `404`: æ¨¡æ¿ä¸å­˜åœ¨
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 10. å®‰å…¨æµ‹è¯•æ¨¡å— (security)

### 10.1 é€Ÿç‡é™åˆ¶æµ‹è¯•

**æ¥å£**: `GET /api/v1/security/rate-limit-test`

**æè¿°**: æµ‹è¯•APIé€Ÿç‡é™åˆ¶åŠŸèƒ½

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "message": "Rate limit test passed",
  "timestamp": "2025-01-08T16:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: æµ‹è¯•é€šè¿‡
- `429`: é€Ÿç‡é™åˆ¶è§¦å‘

### 10.2 å®‰å…¨å¤´æµ‹è¯•

**æ¥å£**: `GET /api/v1/security/security-headers-test`

**æè¿°**: æµ‹è¯•å®‰å…¨å“åº”å¤´è®¾ç½®

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "message": "Security headers test passed"
}
```

**çŠ¶æ€ç **:
- `200`: æµ‹è¯•é€šè¿‡

### 10.3 å…³é”®ç«¯ç‚¹æµ‹è¯•

**æ¥å£**: `POST /api/v1/security/critical-endpoint-test`

**æè¿°**: æµ‹è¯•å…³é”®ç«¯ç‚¹çš„å®‰å…¨æ€§

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "message": "Critical endpoint security test passed"
}
```

**çŠ¶æ€ç **:
- `200`: æµ‹è¯•é€šè¿‡
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 10.4 CORSæµ‹è¯•

**æ¥å£**: `GET /api/v1/security/cors-test`

**æè¿°**: æµ‹è¯•è·¨åŸŸèµ„æºå…±äº«é…ç½®

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "message": "CORS test passed"
}
```

**çŠ¶æ€ç **:
- `200`: æµ‹è¯•é€šè¿‡

### 10.5 è·å–å®‰å…¨çŠ¶æ€

**æ¥å£**: `GET /api/v1/security/security-status`

**æè¿°**: è·å–ç³»ç»Ÿå®‰å…¨çŠ¶æ€

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "security_level": "high",
  "active_protections": ["rate_limiting", "csrf_protection", "xss_protection"],
  "last_security_check": "2025-01-08T16:00:00Z"
}
```

**çŠ¶æ€ç **:
- `200`: è·å–æˆåŠŸ
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

### 10.6 æ¨¡æ‹Ÿæ”»å‡»æµ‹è¯•

**æ¥å£**: `POST /api/v1/security/simulate-attack`

**æè¿°**: æ¨¡æ‹Ÿå®‰å…¨æ”»å‡»ä»¥æµ‹è¯•é˜²æŠ¤æœºåˆ¶

**è¯·æ±‚å‚æ•°**:
- **Query Parameters**:
  - `attack_type` (string, å¿…å¡«): æ”»å‡»ç±»å‹

**å“åº”æ•°æ®**:
```json
{
  "attack_type": "sql_injection",
  "blocked": true,
  "message": "Attack successfully blocked"
}
```

**çŠ¶æ€ç **:
- `200`: æ”»å‡»è¢«æˆåŠŸé˜»æ­¢
- `401`: æœªè®¤è¯
- `403`: æ— æƒé™

---

## 11. ç³»ç»Ÿæ¨¡å— (system)

### 11.1 å¥åº·æ£€æŸ¥

**æ¥å£**: `GET /health`

**æè¿°**: ç³»ç»Ÿå¥åº·æ£€æŸ¥

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "status": "healthy",
  "timestamp": "2025-01-08T16:00:00Z",
  "version": "1.0.0"
}
```

**çŠ¶æ€ç **:
- `200`: ç³»ç»Ÿæ­£å¸¸

### 11.2 æ ¹è·¯å¾„

**æ¥å£**: `GET /`

**æè¿°**: æ ¹è·¯å¾„è®¿é—®

**è¯·æ±‚å‚æ•°**: æ— 

**å“åº”æ•°æ®**:
```json
{
  "message": "Instant Messaging System API",
  "version": "1.0.0",
  "docs_url": "/docs"
}
```

**çŠ¶æ€ç **:
- `200`: è®¿é—®æˆåŠŸ

---

## é”™è¯¯ç è¯´æ˜

### HTTPçŠ¶æ€ç 

- `200`: è¯·æ±‚æˆåŠŸ
- `201`: åˆ›å»ºæˆåŠŸ
- `204`: åˆ é™¤æˆåŠŸï¼Œæ— å†…å®¹è¿”å›
- `400`: è¯·æ±‚å‚æ•°é”™è¯¯
- `401`: æœªè®¤è¯ï¼Œéœ€è¦ç™»å½•
- `403`: æ— æƒé™è®¿é—®
- `404`: èµ„æºä¸å­˜åœ¨
- `422`: è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥
- `429`: è¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè§¦å‘é€Ÿç‡é™åˆ¶
- `500`: æœåŠ¡å™¨å†…éƒ¨é”™è¯¯

### é”™è¯¯å“åº”æ ¼å¼

```json
{
  "detail": "é”™è¯¯æè¿°ä¿¡æ¯"
}
```

æˆ–è€…å¯¹äºéªŒè¯é”™è¯¯ï¼š

```json
{
  "detail": [
    {
      "loc": ["body", "field_name"],
      "msg": "å­—æ®µéªŒè¯é”™è¯¯ä¿¡æ¯",
      "type": "value_error"
    }
  ]
}
```

---

## WebSocket äº‹ä»¶ç±»å‹è¯¦è§£

#### 1. å³æ—¶æ¶ˆæ¯é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `new_message`
- **æè¿°**: æ¥æ”¶åˆ°æ–°çš„å³æ—¶æ¶ˆæ¯

**æ–‡æœ¬æ¶ˆæ¯æ ¼å¼**:
```json
{
  "type": "new_message",
  "data": {
    "message_id": 18,
    "conversation_id": 20,
    "sender_id": 1,
    "content": "Hello!",
    "message_type": "text",
    "timestamp": "2025-01-15T10:30:00Z"
  }
}
```

**æ–‡ä»¶æ¶ˆæ¯æ ¼å¼** (ğŸ†• åŒ…å«å®Œæ•´æ–‡ä»¶ä¿¡æ¯):
```json
{
  "type": "new_message",
  "data": {
    "message_id": 123,
    "conversation_id": 1,
    "sender_id": 2,
    "content": "è¿™æ˜¯ä¸€ä¸ªPDFæ–‡æ¡£",
    "message_type": "file",
    "timestamp": "2025-01-15T10:30:00Z",
    "file_id": "d4b64371-0d7b-4f6b-b97b-34bd6aa6ab10",
    "file_info": {
      "id": 456,
      "file_id": "d4b64371-0d7b-4f6b-b97b-34bd6aa6ab10",
      "name": "é‡è¦æ–‡æ¡£.pdf",
      "path": "2025/01/15/user_2/d4b64371-0d7b-4f6b-b97b-34bd6aa6ab10.pdf",
      "size": 2048000,
      "type": "application/pdf"
    }
  }
}
```

**ä½ç½®æ¶ˆæ¯æ ¼å¼**:
```json
{
  "type": "new_message", 
  "data": {
    "message_id": 124,
    "conversation_id": 1,
    "sender_id": 2,
    "content": "æˆ‘åœ¨è¿™é‡Œ",
    "message_type": "location",
    "timestamp": "2025-01-15T10:30:00Z",
    "latitude": "39.9042",
    "longitude": "116.4074",
    "address": "åŒ—äº¬å¸‚æœé˜³åŒº"
  }
}
```

#### 2. ä¼šè¯åˆ›å»ºé€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `conversation_created`
- **æè¿°**: è¢«é‚€è¯·åŠ å…¥æ–°ä¼šè¯æˆ–ä¼šè¯åˆ›å»ºæˆåŠŸ
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "conversation_created",
  "data": {
    "conversation_id": 5,
    "conversation_type": "group",
    "conversation_name": "æ–°ç¾¤ç»„",
    "creator_id": 1,
    "creator_name": "ç®¡ç†å‘˜",
    "participant_ids": [1, 2, 3],
    "created_at": "2025-01-08T16:00:00Z"
  }
}
```

#### 3. ç”¨æˆ·çŠ¶æ€å˜æ›´é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `user_status_changed`
- **æè¿°**: ç”¨æˆ·åœ¨çº¿çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼ˆä¸Šçº¿æˆ–ä¸‹çº¿ï¼‰
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "user_status_changed",
  "data": {
    "user_id": 2,
    "is_online": true,
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 4. å¹¿æ’­é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `broadcast_received`
- **æè¿°**: æ¥æ”¶åˆ°ç³»ç»Ÿå¹¿æ’­æ¶ˆæ¯
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "broadcast_received",
  "data": {
    "broadcast_id": 456,
    "title": "ç³»ç»Ÿå…¬å‘Š",
    "content": "ç³»ç»Ÿå°†äºä»Šæ™šè¿›è¡Œç»´æŠ¤",
    "priority": "high",
    "sent_at": "2025-01-08T16:00:00Z"
  }
}
```

#### 5. ä¼šè¯æ›´æ–°é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `conversation_updated`
- **æè¿°**: ä¼šè¯ä¿¡æ¯è¢«æ›´æ–°ï¼ˆåŒ…æ‹¬åç§°ã€æè¿°ç­‰ï¼‰
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "conversation_updated",
  "data": {
    "conversation_id": 1,
    "updater_id": 2,
    "update_type": "name_updated",
    "participant_ids": [1, 2, 3],
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 6. æ·»åŠ æˆå‘˜é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `member_added`
- **æè¿°**: æœ‰æ–°æˆå‘˜åŠ å…¥ä¼šè¯
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "member_added",
  "data": {
    "conversation_id": 1,
    "operator_id": 1,
    "added_user_ids": [4, 5],
    "participant_ids": [1, 2, 3, 4, 5],
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 7. ç§»é™¤æˆå‘˜é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `member_removed`
- **æè¿°**: æœ‰æˆå‘˜è¢«ç§»é™¤å‡ºä¼šè¯æˆ–ä¸»åŠ¨é€€å‡º
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "member_removed",
  "data": {
    "conversation_id": 1,
    "operator_id": 1,
    "removed_user_id": 3,
    "participant_ids": [1, 2],
    "is_self_exit": false,
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 8. ä¼šè¯åˆ é™¤é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `conversation_deleted`
- **æè¿°**: ä¼šè¯è¢«åˆ é™¤æˆ–ç¾¤ç»„è¢«è§£æ•£
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "conversation_deleted",
  "data": {
    "conversation_id": 1,
    "operator_id": 1,
    "conversation_type": "group",
    "participant_ids": [1, 2, 3],
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 9. è§’è‰²å˜æ›´é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `role_changed`
- **æè¿°**: ç¾¤ç»„æˆå‘˜è§’è‰²å‘ç”Ÿå˜åŒ–ï¼ˆåŒ…æ‹¬ç¾¤ä¸»è½¬è®©ï¼‰
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "role_changed",
  "data": {
    "conversation_id": 1,
    "operator_id": 1,
    "target_user_id": 2,
    "old_role": "member",
    "new_role": "admin",
    "participant_ids": [1, 2, 3],
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 10. æ°´å°ä¿®æ”¹é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `watermark_updated`
- **æè¿°**: ä¼šè¯æ°´å°è¢«ä¿®æ”¹
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "watermark_updated",
  "data": {
    "conversation_id": 1,
    "operator_id": 1,
    "watermark_text": "ä¿å¯†ä¿¡æ¯ï¼Œè¯·å‹¿å¤–ä¼ ",
    "participant_ids": [1, 2, 3],
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 11. ç”¨æˆ·ä½ç½®æ›´æ–°é€šçŸ¥
- **äº‹ä»¶ç±»å‹**: `location_updated`
- **æè¿°**: ç”¨æˆ·ä½ç½®ä¿¡æ¯æ›´æ–°
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "location_updated",
  "data": {
    "user_id": 1,
    "latitude": 39.908815,
    "longitude": 116.397527,
    "accuracy": 10.5,
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### 12. æ­£åœ¨è¾“å…¥æŒ‡ç¤º
- **äº‹ä»¶ç±»å‹**: `typing_indicator`
- **æè¿°**: ç”¨æˆ·æ­£åœ¨è¾“å…¥çŠ¶æ€æŒ‡ç¤º
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "typing_indicator",
  "data": {
    "conversation_id": 1,
    "sender_id": 2,
    "is_typing": true,
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

#### ä¼ ç»Ÿäº‹ä»¶ç±»å‹ï¼ˆè¿æ¥ç®¡ç†ï¼‰

#### 13. è¿æ¥å»ºç«‹ç¡®è®¤
- **äº‹ä»¶ç±»å‹**: `connection_established`
- **æè¿°**: WebSocketè¿æ¥å»ºç«‹æˆåŠŸç¡®è®¤
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "connection_established",
  "connection_id": "uuid-123",
  "user_id": 1,
  "timestamp": "2025-01-08T16:00:00Z"
}
```

#### 14. å¿ƒè·³åŒ…
- **äº‹ä»¶ç±»å‹**: `heartbeat`
- **æè¿°**: æœåŠ¡å™¨å‘é€çš„å¿ƒè·³åŒ…
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "heartbeat",
  "timestamp": "2025-01-08T16:00:00Z"
}
```

#### 15. Pingå“åº”
- **äº‹ä»¶ç±»å‹**: `pong`
- **æè¿°**: å¯¹å®¢æˆ·ç«¯pingçš„å“åº”
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "pong",
  "timestamp": "2025-01-08T16:00:00Z"
}
```

#### 16. æ¶ˆæ¯çŠ¶æ€æ›´æ–°
- **äº‹ä»¶ç±»å‹**: `message_status`
- **æè¿°**: æ¶ˆæ¯å‘é€çŠ¶æ€æ›´æ–°
- **æ•°æ®æ ¼å¼**:
```json
{
  "type": "message_status",
  "data": {
    "messageId": "msg-123",
    "status": "sent",
    "timestamp": "2025-01-08T16:00:00Z"
  }
}
```

---

## å¼€å‘è¯´æ˜

### ç¯å¢ƒè¦æ±‚

- Python 3.12+
- MySQL 8.0+
- Redis 6.0+
- RabbitMQ 3.8+

### æœ¬åœ°å¼€å‘

1. å®‰è£…ä¾èµ–ï¼š`pip install -r requirements.txt`
2. é…ç½®ç¯å¢ƒå˜é‡
3. è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š`alembic upgrade head`
4. å¯åŠ¨æœåŠ¡ï¼š`uvicorn app.main:app --reload`

### APIæ–‡æ¡£

- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`
- OpenAPI JSON: `http://localhost:8000/openapi.json`

---

## ğŸ§ª ç³»ç»Ÿæµ‹è¯•çŠ¶æ€

### æœ€æ–°æµ‹è¯•ç»“æœ (v1.0.1)
- **æµ‹è¯•æ—¶é—´**: 2025-01-15
- **æµ‹è¯•è¦†ç›–ç‡**: 100% âœ…
- **æµ‹è¯•é¡¹ç›®**: 
  - âœ… APIç»“æ„å®Œæ•´æ€§
  - âœ… æ•°æ®åº“æ¨¡å‹
  - âœ… CRUDæ“ä½œ
  - âœ… æ–‡ä»¶æœåŠ¡
  - âœ… WebSocketæ¶ˆæ¯å‘å¸ƒ
  - âœ… æ–‡ä»¶æ¶ˆæ¯å“åº”ç»“æ„
  - âœ… WebSocketæ¶ˆæ¯ç»“æ„

### æ ¸å¿ƒåŠŸèƒ½éªŒè¯
- **æ–‡ä»¶å‘é€**: âœ… å®Œæ•´çš„file_infoæ¨é€
- **æ–‡ä»¶ä¸‹è½½**: âœ… æƒé™è‡ªåŠ¨åˆ›å»º
- **WebSocketæ¨é€**: âœ… åŒ…å«å®Œæ•´æ–‡ä»¶ä¿¡æ¯
- **APIå“åº”**: âœ… æ–‡ä»¶ä¿¡æ¯å®Œæ•´è¿”å›
- **æƒé™ç®¡ç†**: âœ… FileShareè‡ªåŠ¨å¤„ç†

### å®¢æˆ·ç«¯é›†æˆå°±ç»ª
ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿›è¡Œå®¢æˆ·ç«¯é›†æˆï¼Œæ‰€æœ‰APIå’ŒWebSocketåŠŸèƒ½å·²éªŒè¯å¯ç”¨ã€‚

---

*æœ¬æ–‡æ¡£æœ€åæ›´æ–°æ—¶é—´ï¼š2025-01-15*

